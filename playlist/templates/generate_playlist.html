<!-- generate_playlist.html -->
<form method="POST" id="playlist-form">
    {% csrf_token %}

    <input type="text" id="author-input" name="artist" placeholder="Введіть автора" required>
    <ul id="author-list"></ul>

    <input type="text" id="genre-input" name="genre" placeholder="Введіть жанр">
    <ul id="genre-list"></ul>

    <select name="mood" id="mood-select" required>
        <option value="">Оберіть настрій</option>
        <option value="happy">Happy</option>
        <option value="sad">Sad</option>
        <option value="chill">Chill</option>
        <option value="other">Other</option>
    </select>

    <input type="number" name="number_of_songs" min="1" max="50" placeholder="Кількість пісень" required>

    <button type="submit">Згенерувати плейлист</button>
</form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Автозаповнення авторів
        $("#author-input").on("input", function () {
            let query = $(this).val();
            if (query.length > 0) {
                $.ajax({
                    url: "{% url 'author_autocomplete' %}",
                    data: { term: query },
                    success: function (data) {
                        $("#author-list").empty();
                        data.forEach(function (author) {
                            $("#author-list").append(`<li>${author}</li>`);
                        });
                    }
                });
            } else {
                $("#author-list").empty();
            }
        });

        $(document).on("click", "#author-list li", function () {
            $("#author-input").val($(this).text());
            $("#author-list").empty();
        });

        // Автозаповнення жанрів
        $("#genre-input").on("input", function () {
            let query = $(this).val();
            if (query.length > 0) {
                $.ajax({
                    url: "{% url 'genre_autocomplete' %}",
                    data: { term: query },
                    success: function (data) {
                        $("#genre-list").empty();
                        data.forEach(function (genre) {
                            $("#genre-list").append(`<li>${genre}</li>`);
                        });
                    }
                });
            } else {
                $("#genre-list").empty();
            }
        });

        $(document).on("click", "#genre-list li", function () {
            $("#genre-input").val($(this).text());
            $("#genre-list").empty();
        });
    });
</script>
